<!DOCTYPE html>
<html lang="en">
<head>
          <title>Wordpress [Bugs/Hacks/Tweaks/Tricks]? I am not sure</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="utf-8" />
        <link href="https://tunnelshade.in/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="bharadwaj.machiraju Full Atom Feed" />


    <meta name="tags" content="tricks" />
    <meta name="tags" content="hacks" />


        <!-- CSS -->
        <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css" integrity="sha384-b92sF+wDNTHrfEtRaYo+EpcA8FUyHOSXrdxKc9XB9kaaX1rSQAgMevW6cYeE5Bdv" crossorigin="anonymous">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://tunnelshade.in/theme/css/main.css">
        <!-- End CSS -->
  <link rel="stylesheet" href="https://tunnelshade.in/theme/css/blog.css">

        <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-40078808-2', 'tunnelshade.in');
  ga('send', 'pageview');
</script></head>

<body id="index" class="home">
  <br>
  <div class="pure-g">
    <div class="pure-u-2-24"></div>
    <div class="pure-u-20-24">
      <div class="pure-g">
        <div class="pure-u-md-20-24 pure-u-lg-20-24 pure-u-sm-24-24" style="display: flex; align-items: center;">
            <h1>
              <a href="https://tunnelshade.in/">bharadwaj.machiraju </a>   &raquo; <a href="https://tunnelshade.in/blog/index.html">Blog</a> <a href="https://tunnelshade.in/feeds/all.atom.xml"><i class="fa fa-rss"></i></a>
            </h1>
        </div>
        <div class="pure-u-md-4-24 pure-u-lg-4-24 pure-u-sm-0-24" style="display: flex; align-items: center;">
          <img class="logo" src="https://tunnelshade.in/theme/images/logo.png"/>
        </div>
      </div>
      <br>
      <hr>
      <br>
      <div class="pure-g">
  <div class="pure-g">
    <div class="pure-u-1 pure-u-md-4-5 pure-u-lg-4-5 pure-u-xl-4-5">
<section id="content" class="body">
  <header class="pure-g"><div class="pure-u-1">
    <h2 class="entry-title">
      <a href="https://tunnelshade.in/blog/2014/06/wordpress-tricks/" rel="bookmark"
         title="Permalink to Wordpress [Bugs/Hacks/Tweaks/Tricks]? I am not sure">Wordpress [Bugs/Hacks/Tweaks/Tricks]? I am not sure</a></h2>
  </div></header>
  <footer class="pure-g"><div class="pure-u-1">

    <time class="published" datetime="2014-06-27T00:00:00+05:30">
      [27-06-14]
    </time>

    [<a href="/category/bugs/">Bugs</a>]

    [tricks,hacks]

  </div></footer><!-- /.post-info -->
  <div class="pure-g"><div class="pure-u-1">
    <p>The following is writeup of how I dealt with a specific circumstance. I was up against a wordpress
installation in one of my tests and luckily I already had <strong>editor</strong> level credentials. So I have to somehow obtain a
shell. Remember that editor's do not have the ability to <strong>edit/add themes/plugins</strong>. So, aim was to run php using my
editor privileges.</p>
<h4>Solid Facts :</h4>
<ul>
<li>I can add html in the site using <em>editor privileges</em> (i.e unfiltered_html capability for editors).</li>
<li>Nothing more valuable than the above point. (Later found some interesting places in dashboard where payloads work).</li>
</ul>
<h4>Methods which won't work :</h4>
<ul>
<li>Cannot steal cookies of administrator, since <strong>httponly</strong> flag is set on cookies.</li>
<li>No dumb popups asking for password because that might create suspicion, we ain't dealing with skiddies.</li>
<li>Solid patched wordpress with up-to-date plugins.</li>
</ul>
<h4>Methods which will :</h4>
<ol>
<li>
<p>Resetting <strong>admin</strong> password. I wrote a sample POC which when run resets admin password to <strong>t3st</strong>.</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">siteUrl</span> <span class="o">=</span> <span class="s1">&#39;http://wordpress.org&#39;</span> <span class="c1">// Wordpress site url</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">siteUrl</span><span class="o">+</span><span class="s2">&quot;/wp-admin/profile.php?wp_http_referer=%2Fwp-admin%2Fusers.php&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">);</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#pass1&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;t3st&#39;</span><span class="p">;</span> <span class="c1">// New password</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#pass2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;t3st&#39;</span><span class="p">;</span> <span class="c1">// Confirm password</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#submit&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">click</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>


</li>
<li>
<p>User roles can be changed by admin in the interface, so again with some <strong>js-fu</strong> we can generate these requests to escalate our editor account to admin.</p>
</li>
<li>Admin can write php directly to themes and plugins, so something like <a href="https://nealpoole.com/blog/2011/01/how-does-cross-site-scripting-become-arbitrary-code-execution-an-ode-to-the-oft-maligned-referer-header/">this</a> can be done.</li>
<li>Email address of the admin can also be changed instead of password, then password reset and boom.</li>
</ol>
<p>Since I am lazy, I just created POC for the first one. Off all the above, I used the third one to write some file of the theme and I popped a hard <strong>shell</strong>.
So the crisp till now is <strong>Even though wordpress doesn't allow editors to write php directly, we can do it in an indirect manner</strong></p>
<p>Hold on folks, I know what you are thinking, for the above attacks to work, <em>a loggedin admin</em> has to visit an infected post/page. I will say
not required. <strong>WHY?</strong></p>
<h4>Added advantages :</h4>
<ul>
<li>
<p>A JS-payload entered in the title of a new post/page (by using editor obviously) gets executed right in the homepage of dashboard. <strong>WTF? WHERE?</strong></p>
<div class="highlight"><pre><span></span>Recently Published section in the dashboard shows the latest posts/pages, so payloads get executed there
</pre></div>


</li>
<li>
<p>Payload also gets executed in <strong>Revisions</strong> of that particular post/page.</p>
</li>
<li>Obviously the original page/post.</li>
</ul>
<h4>And in a flash I remembered two statements :</h4>
<ul>
<li>Privilege escalation</li>
<li><a href="http://make.wordpress.org/core/handbook/reporting-security-vulnerabilities/#why-are-some-users-allowed-to-post-unfiltered-html">Content is never displayed unfiltered in the admin</a></li>
</ul>
<p>Reported these to wordpress and they classified these bugs as :</p>
<ul>
<li>Won't Fix</li>
<li>N.A</li>
</ul>
<p>May be they are right, but then why different accounts for <em>admin</em> and <em>editor</em> when both can do same set of tasks ;)</p>
  </div></div><!-- /.entry-content -->
</section>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://tunnelshade.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>    </div>
    <div class="pure-u-1 pure-u-md-1-5 pure-u-lg-1-5 pure-u-xl-1-5 blog_sidebar">
      <strong>Categories</strong>
      <ul>
          <li><a href="/category/bugs/">Bugs</a> [6]</li>
          <li><a href="/category/hacks/">Hacks</a> [2]</li>
          <li><a href="/category/information/">Information</a> [5]</li>
          <li><a href="/category/linux/">Linux</a> [7]</li>
          <li><a href="/category/python/">Python</a> [4]</li>
          <li><a href="/category/tools/">Tools</a> [12]</li>
      </ul>

      <br>

      <strong>Tags</strong>
      <ul>
          <li><a href="/tag/reversing/">reversing</a> [5]</li>
          <li><a href="/tag/tools/">tools</a> [11]</li>
          <li><a href="/tag/fuzzing/">fuzzing</a> [3]</li>
          <li><a href="/tag/afl/">afl</a> [2]</li>
          <li><a href="/tag/tricks/">tricks</a> [11]</li>
          <li><a href="/tag/info/">info</a> [12]</li>
          <li><a href="/tag/python/">python</a> [3]</li>
          <li><a href="/tag/hacks/">hacks</a> [5]</li>
          <li><a href="/tag/conference/">conference</a> [2]</li>
          <li><a href="/tag/linux/">linux</a> [5]</li>
          <li><a href="/tag/owtf/">owtf</a> [3]</li>
          <li><a href="/tag/screenshots/">screenshots</a> [3]</li>
      </ul>

      <br>

      <strong>Author</strong>
<ul class="no_bullets">
    <li><a class="no_underline" href="https://twitter.com/tunnelshade_"><i class="fa fa-twitter"></i> @tunnelshade_</a></li>
    <li><a class="no_underline" href="https://github.com/tunnelshade"><i class="fa fa-github"></i> Github</a></li>
    <li><a class="no_underline" href="https://www.linkedin.com/in/tunnelshade/"><i class="fa fa-linkedin"></i> LinkedIn</a></li>
    <li><a class="no_underline" href="domain_without_tld@gmail.com"><i class="fa fa-envelope"></i> domain_without_tld@gmail.com</a></li>
</ul>
    </div>
  </div>
      </div>
    </div>
    <div class="pure-u-2-24"></div>
  </div>
</body>
</html>